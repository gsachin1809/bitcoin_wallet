angular.module("pms.service").factory("AdminLogin",["$resource","$log","$http","Base","locker","$state",function(e,t,r,o,n,u){var i={};return i.resource=function(){var t=o.home_url+"/api_v1/admin/login";return e(t,{},{login:{method:"POST",params:{}}})},i.checklogin=function(){var e=n.get("auth_user");return void 0!=typeof e&&void 0!==e},i.user_name=function(){var e=n.get("auth_user");return e.first_name+" "+e.last_name},i.logout=function(){console.log("call logout"),n.has("auth_user")&&n.forget("auth_user"),u.go("login")},i}]),angular.module("pms.service").factory("Base",function(){var e="",t="",r="",o="";return"127.0.0.1"==location.hostname?(e="http://127.0.0.1:8000/ajax",t="http://127.0.0.1:8000",r="http://127.0.0.1:8000/api_v1/admin/login",o="http://127.0.0.1:8000/api_v1/admin/logout"):(e="http://"+location.hostname+"/ajax",t="http://"+location.hostname,r="http://"+location.hostname+"/ajax/admin/login",o="http://"+location.hostname+"/ajax/admin/logout"),{app_url:e,home_url:t,admin_login_url:r,admin_logout_url:o}}),angular.module("pms.service").factory("User",["$q","Resources","locker","$rootScope",function(e,t,r,o){var n={};return n.authenticate=function(r,o){var n=e.defer();return t.authentication().auth({},{phonenumber:r,password:o},function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},n.save_auth_token=function(e){r.put("token",e),r.put("is_expired",!1)},n.is_logged_in=function(){return!r.get("is_expired",!0)&&null!=r.get("token",null)},n.get_logged_in_user=function(){return n.is_logged_in()?r.get("current_user",null):null},n.logout=function(){r.forget("active_organization",null),r.forget("token",null),r.forget("is_expired",null),r.forget("current_user",null),o.$broadcast("user_logged_out",{})},n.inValidateUser=function(){var u=e.defer();{if(n.is_logged_in())return t.token().get({token:r.get("token",null)},function(e){void 0!=e.user?(r.put("current_user",e.user),u.resolve(e)):(o.$broadcast("user_logged_out",{}),u.reject(e))},function(e){console.log(e);var t=e.data;if(void 0!=t.errors){var r=t.errors[0];void 0==r.token_not_found&&void 0==r.token_expired||(n.logout(),o.$broadcast("user_logged_out",{}))}u.reject(e)}),u.promise;o.$broadcast("user_logged_out",{})}},n.getSystemAdmin=function(r){var o=e.defer();return t.user().get({type:2,page:r},function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},n.addAdminUser=function(r,o,n){var u=e.defer();return t.user().add({phonenumber:r,email:o,password:n,type:2},function(e){u.resolve(e)},function(e){u.reject(e)}),u.promise},n.updateUser=function(r,o){var n=e.defer();return t.user().update({user_id:r},o,function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},n.deleteUser=function(r){var o=e.defer();return t.user().delete({user_id:r},function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},n.getUser=function(r){var o=e.defer();return t.user().show({user_id:r},{},function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},n.getUserOrg=function(r,o,n){var u=e.defer();return t.user_org(r).get({page:o,search:n},function(e){u.resolve(e)},function(e){u.reject(e)}),u.promise},n}]);